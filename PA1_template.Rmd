---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

Reproducible Research: Peer Assessment 1
========================================
Harry Braviner


## Loading and preprocessing the data

We unzip the data (if necessary), read it in as a data frame and convert the **date** variable from the *factor* to the *date* datatype.

```{r echo=TRUE}
if(!file.exists("activity.csv"))
  unzip("activity.csv")
data <- read.csv("activity.csv")
data$date <- as.Date(data[,"date"])
```



## What is mean total number of steps taken per day?

Let's first compute a vector containing the total number of steps taken each day and produce a histogram (I'm putting a rug under it since I think it adds useful information).

```{r, echo=TRUE, fig.width=7, fig.height=7}
stepCounts <- by(data$steps, data$date, sum, na.rm=TRUE)
hist(stepCounts, breaks=10, col = "blue", main = "", xlab = "Total number of steps taken in a day")
rug(stepCounts)
```

Now we compute the mean and median steps-per-day.

```{r, echo=TRUE}
meanSteps <- mean(stepCounts)
medianSteps <- median(stepCounts)
```

The mean number of steps-per-day is `r meanSteps` and the median number of steps-per-day is `r medianSteps`.

## What is the average daily activity pattern?

Create a vector of the averages over all days of the number of steps in each interval.
The names of this vector correspond to the times.

```{r, echo=TRUE}
averagedStepsPerInterval <- by(data$steps, data$interval, mean, na.rm=TRUE, simplify=TRUE)
```

I've changed the labelling of the x-axis to be the actual time, since the interval numbers aren't very nicely formatted (i.e. I think "15:00" is clearer than "1500" as a label for 3pm!)

```{r, echo=TRUE, fig.width=7, fig.height=5}
plot(names(averagedStepsPerInterval), averagedStepsPerInterval, type="l", col="red",
      xlab="Time", ylab="Steps in 5 minute interval", xaxt="n",
      main="Steps per interval averaged over all days")
axis(side=1, at = c("0", "600", "1200", "1800", "2355"),
      labels = c("00:00", "06:00", "12:00", "18:00", "23:55"))
```

## Inputing missing values

```{r, echo=TRUE}
totalMissing <- sum(is.na(data$steps) | is.na(data$date) | is.na(data$interval))
totalMissing
```
So there are `r totalMissing` observations where at least one of the variables is missing.

As an aside, we can see from the fact that the next bit of code that all of these NAs are in the **steps** variables;
no observations of the **date** or **interval** have been coded as NA.
```{r, echo=TRUE}
sum(is.na(data$date))
sum(is.na(data$interval))
```

My strategy for filling in the missing data is to replace each missing value with the mean for that 5-minute interval, averaged over all the days for which that interval does have data.
This is convenient, since I computed a vector of such values in the previous section.

```{r, echo=TRUE}
# Note that this makes a copy of the data frame
# (unlike a data table, where we're just create a reference)
dataWithMeans <- data
# Now loop through the rows replacing the steps entry with the mean
# value as necessary
for (i in 1:nrow(dataWithMeans)){
  if(is.na(dataWithMeans[i,"steps"]))
    dataWithMeans[i,"steps"] <- averagedStepsPerInterval[as.character(dataWithMeans[i,"interval"])]
}
```

Just as a check that this has been done correctly, let's look at a couple of examples where the original data has missing values and check that the replacement has worked

```{r, echo=TRUE}
data[10, "steps"]
dataWithMeans[10, "steps"]
dataWithMeans[10, "interval"]
averagedStepsPerInterval["45"]
```
So this has indeed replaced NAs with values from the vector of means.


## Are there differences in activity patterns between weekdays and weekends?

First let's add a new variable called **weekday** to the data, using an anonymous function.
```{r, echo=TRUE}
dataWithMeans$weekday <- sapply(dataWithMeans$date,
                                 function(d) {w <- weekdays(d);
				               if(w == "Saturday" | w == "Sunday") {
					         return("weekend")
					       } else {
					         return("weekday")
					       }
					      })
#The new variable is of type character, so we now convert it to a factor variable
dataWithMeans$weekday <- as.factor(dataWithMeans$weekday)
```
